---
import IntroSnippet from "../data/snippets/intro.mdx";
---

<dialog data-intro autofocus closedby="any">
    <IntroSnippet />
    <button data-intro="close"
        ><span>[</span><span>Close</span><span>]</span></button
    >
</dialog>
<button data-intro="open" class="ui-button">?</button>
<style>
    dialog {
        max-width: min(45ch, 95vw);
        padding: 1.5em;
        color: var(--color-ink);

        border: 4px solid var(--color-ink);
        border-radius: 2px;
        background-color: #ffffffcc;
        backdrop-filter: blur(4px);
        box-shadow: 4px 4px 0 #00000022;
    }

    dialog[open] {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    dialog :global(h1) {
        margin: 0;
    }

    dialog :global(p) {
        text-decoration: underline;
        text-decoration-style: dotted;
        margin: 1em 0 0;
    }

    dialog :global(::selection) {
        color: var(--color-paper);
        background-color: var(--color-ink);
    }

    dialog:focus,
    dialog:focus-visible,
    dialog:focus-within {
        outline: none;
    }

    button[data-intro="close"] {
        font-family: var(--font-sans);
        font-weight: bold;

        margin-top: 2em;
        padding-top: 0.1em;
        padding-bottom: 0.3em;

        display: flex;
        gap: 1ex;
        transition: gap 0.2s;
    }

    button[data-intro="close"]:hover {
        gap: 2ex;
    }

    button[data-intro="close"]:focus,
    button[data-intro="close"]:focus-within,
    button[data-intro="close"]:focus-visible {
        outline: none;
        background-color: var(--color-ink);
        color: var(--color-paper);
    }

    dialog::backdrop {
        opacity: 0.2;
        background-color: black;
    }

    button[data-intro="open"] {
        position: fixed;
        bottom: 8px;
        left: 8px;
        width: 2.3em;
        aspect-ratio: 1 / 1;
        z-index: 2;
    }
</style>
<script>
    function initIntroDialog() {
        const dialog = document.querySelector(
            "dialog[data-intro]",
        ) as HTMLDialogElement;
        if (!dialog) return;

        const lsk = "SEEN_INTRO_POPUP";
        const show = window.localStorage.getItem(lsk) === null;

        function open() {
            window.localStorage.removeItem(lsk);
            dialog.showModal();
        }

        function close() {
            dialog.close();
        }

        dialog.addEventListener("close", () =>
            window.localStorage.setItem(lsk, "true"),
        );

        document.querySelectorAll("button[data-intro]").forEach((_e) => {
            const button = _e as HTMLButtonElement;
            button.addEventListener(
                "click",
                button.dataset.intro === "close" ? close : open,
            );
        });

        if (show) {
            dialog.showModal();
        }
    }

    document.addEventListener("DOMContentLoaded", initIntroDialog);
    document.addEventListener("astro:after-swap", initIntroDialog);
</script>
